async function upload(){if(files.length){const e=200===(await fetch(`${window.location.href}/password-check`,{headers:{Authorization:`Basic ${password.value}`}})).status;if(e){clearListBtn.style.display="none",abortBtn.style.display="inline-block";const e=new FormData;for(let t=0,s=files.length;t<s;t++)e.append(files[t].name,files[t],files[t].name);setProgress(0);const t=new XMLHttpRequest;requests.push(t),t.responseType="text",t.upload.onprogress=(e=>setProgress(Math.round(e.loaded/e.total*100))),t.onerror=errorHandler,t.onreadystatechange=(()=>{0!==t.status&&completeHandler(t),uploadBtn.addEventListener("click",upload,{once:!0})}),t.onload=completeHandler,t.open("POST",window.location.href),t.setRequestHeader("Authorization",`Basic ${password.value}`),t.send(e)}else showError("Invalid password")}else showError("You need to select files first")}function completeHandler(e){if(e.status<200||e.status>=400)errorHandler(e);else{uploadBtn.style.display="inline-block",clearListBtn.style.display="inline-block",abortBtn.style.display="none",statusEl.style.display="none";for(let e=0,t=files.length;e<t;e++)addUrl(files[e].name);for(files=[],fileInput.value="";fileList.firstChild;)fileList.removeChild(fileList.lastChild);setTimeout(()=>{setProgress(0)},2e3)}}function errorHandler(e){console.log(`Error. ${e.responseText}`),uploadBtn.style.display="inline-block",clearListBtn.style.display="inline-block",abortBtn.style.display="none",abortRequests(),setProgress(0),401===e.status?showError("Invalid password"):showError(`Something went wrong.\nError: ${e.responseText}`),uploadBtn.addEventListener("click",upload,{once:!0})}function humanReadableFilesize(e){const t=1,s=1024;if(Math.abs(e)<s)return e+" B";const n=["kB","MB","GB","TB","PB","EB","ZB","YB"];let l=-1;const o=10**t;do{e/=s,++l}while(Math.round(Math.abs(e)*o)/o>=s&&l<n.length-1);return e.toFixed(t)+" "+n[l]}function setProgress(e){const t=Math.round(e);progress.style.width=`${t}%`,progress.ariaValueNow=t,progressPercentage.innerText=`${0===e?e:e.toFixed(1)} %`}function addFile(e){const t=document.createElement("li"),s=document.createElement("div"),n=document.createElement("span"),l=document.createElement("span"),o=document.createElement("button");files.push(e),t.classList.add("list-group-item"),l.classList.add("text-secondary","ml-3"),o.classList.add("btn","btn-primary"),n.innerText=e.name,l.innerText=humanReadableFilesize(e.size),s.appendChild(n),s.appendChild(l),t.appendChild(s),fileList.appendChild(t)}function addUrl(e){const t=document.createElement("li"),s=document.createElement("a"),n=document.createElement("button"),l=document.createElement("img");t.classList.add("list-group-item","d-flex","justify-content-between","align-items-center"),n.classList.add("btn","btn-primary","mx-2");let o=`${location.origin}/files/${e}`;["mp4","ogg"].includes(e.split(".").pop())&&(o+="?embed=true"),s.href=o,s.target="_blank",s.innerText=e,l.src="/assets/copy.svg",n.onclick=(e=>{navigator.clipboard.writeText(o),n.classList.replace("btn-primary","btn-success"),l.src="/assets/done.svg",setTimeout(()=>{n.classList.replace("btn-success","btn-primary"),l.src="/assets/copy.svg"},1500)}),t.appendChild(s),n.appendChild(l),t.appendChild(n),url.appendChild(t)}function showError(e){statusEl.innerText=e,statusEl.style.display="flex"}function abortRequests(){for(let e=0,t=requests.length;e<t;e++)requests[e].abort()}const password=document.getElementById("password"),fileInput=document.getElementById("fileInput"),fileList=document.getElementById("fileList"),fileHover=document.getElementById("fileHover"),uploadBtn=document.getElementById("uploadBtn"),clearListBtn=document.getElementById("clearListBtn"),abortBtn=document.getElementById("abortBtn"),progress=document.getElementById("progress"),progressPercentage=document.getElementById("progressPercentage"),url=document.getElementById("url"),statusEl=document.getElementById("status");let files=[],requests=[];const fontCSS=document.createElement("link");fontCSS.href="/assets/fonts.min.css",fontCSS.rel="stylesheet",fontCSS.type="text/css",document.head.appendChild(fontCSS),window.ondrop=(e=>e.preventDefault()),window.ondragover=(e=>e.preventDefault()),fileList.ondragover=(e=>{e.preventDefault(),fileHover.style.display="flex"}),window.ondrop=(e=>{e.preventDefault(),fileHover.style.display="none";const t=e.dataTransfer.files;for(let e=0,s=t.length;e<s;e++)addFile(t[e])}),fileHover.ondragleave=(e=>{e.preventDefault(),fileHover.style.display="none"}),fileInput.onchange=(e=>{const t=e.currentTarget.files;for(let e=0,s=t.length;e<s;e++)addFile(t[e])}),uploadBtn.addEventListener("click",upload,{once:!0}),clearListBtn.onclick=(e=>{for(statusEl.style.display="none",setProgress(0),files=[],fileInput.value="";fileList.firstChild;)fileList.removeChild(fileList.lastChild)}),abortBtn.onclick=(e=>{statusEl.style.display="none",abortBtn.style.display="none",clearListBtn.style.display="inline-block",abortRequests(),setProgress(0),uploadBtn.addEventListener("click",upload,{once:!0})});